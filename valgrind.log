==============================
v0.0.1--normality version

$ valgrind ./a.out -v
==7022== Memcheck, a memory error detector
==7022== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==7022== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==7022== Command: ./a.out -v
==7022== 
v0.0.1
a[0]:0
==7022== 
==7022== HEAP SUMMARY:
==7022==     in use at exit: 0 bytes in 0 blocks
==7022==   total heap usage: 0 allocs, 0 frees, 0 bytes allocated
==7022== 
==7022== All heap blocks were freed -- no leaks are possible
==7022== 
==7022== For counts of detected and suppressed errors, rerun with: -v
==7022== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)

==============================
v0.0.1-1
对于栈的访问越界，valgrind
检查不出来，在代码中加入对数字访问越界的访问，可见效果如下，没有什么特别之处。
$ valgrind ./a.out -v
==7261== Memcheck, a memory error detector
==7261== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==7261== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==7261== Command: ./a.out -v
==7261== 
v0.0.1-1
a[0]:0
a[10]:0
==7261== 
==7261== HEAP SUMMARY:
==7261==     in use at exit: 0 bytes in 0 blocks
==7261==   total heap usage: 0 allocs, 0 frees, 0 bytes allocated
==7261== 
==7261== All heap blocks were freed -- no leaks are possible
==7261== 
==7261== For counts of detected and suppressed errors, rerun with: -v
==7261== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)

==============================
diff --git a/memory_init.c b/memory_init.c
index d42f898..a7150f4 100644
--- a/memory_init.c
+++ b/memory_init.c
@@ -1,7 +1,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-#define VERSION	"v0.0.1-1"
+#define VERSION	"v0.0.2-0"
 void printf_version(int argc, char *argv[])
 {
 	int t;
@@ -19,12 +19,10 @@ void printf_version(int argc, char *argv[])
 int main(int argc, char *argv[])
 {
 	printf_version(argc, argv);
-
-	int a[1];
-	a[0] = 0;
-	fprintf(stdout, "a[0]:%d\n", a[0]);
-	a[10] = 0;
-	fprintf(stdout, "a[10]:%d\n", a[10]);
+	int *p;
+	p = malloc(sizeof(*p) * 2);
+	p[2]  = 0;
+	free(p);
 
 	return 0;
 }


$ valgrind ./a.out -v
==8042== Memcheck, a memory error detector
==8042== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==8042== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==8042== Command: ./a.out -v
==8042== 
v0.0.2-0
/* p[2]  = 0; */
==8042== Invalid write of size 4 
==8042==    at 0x8048522: main (memory_init.c:24)
==8042==  Address 0x41f4030 is 0 bytes after a block of size 8 alloc'd
==8042==    at 0x402BE68: malloc (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==8042==    by 0x8048516: main (memory_init.c:23)
==8042== 
==8042== 
==8042== HEAP SUMMARY:
==8042==     in use at exit: 0 bytes in 0 blocks
==8042==   total heap usage: 1 allocs, 1 frees, 8 bytes allocated
==8042== 
==8042== All heap blocks were freed -- no leaks are possible
==8042== 
==8042== For counts of detected and suppressed errors, rerun with: -v
==8042== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

我们可以看到，无效的写发生在p[2]的地方，数组的最大下标应该是2-1=1。
程序提示我们用-v选项查看更详细的信息：

$ valgrind -v ./a.out -v
==8086== Memcheck, a memory error detector
==8086== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==8086== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==8086== Command: ./a.out -v
==8086== 
--8086-- Valgrind options:
--8086--    --suppressions=/usr/lib/valgrind/debian-libc6-dbg.supp
--8086--    -v
--8086-- Contents of /proc/version:
--8086--   Linux version 3.2.0-55-generic (buildd@allspice) (gcc version 4.6.3 (Ubuntu/Linaro 4.6.3-1ubuntu5) ) #85-Ubuntu SMP Wed Oct 2 13:43:27 UTC 2013
--8086-- Arch and hwcaps: X86, x86-sse1-sse2
--8086-- Page sizes: currently 4096, max supported 4096
--8086-- Valgrind library directory: /usr/lib/valgrind
--8086-- Reading syms from /lib/i386-linux-gnu/ld-2.15.so (0x4000000)
--8086--   Considering /lib/i386-linux-gnu/ld-2.15.so ..
--8086--   .. CRC mismatch (computed a9bcb2b6 wanted 8af3f2f5)
--8086--   Considering /usr/lib/debug/lib/i386-linux-gnu/ld-2.15.so ..
--8086--   .. CRC is valid
--8086-- Reading syms from /mnt/data/gitstorage/valgrind/a.out (0x8048000)
--8086-- Reading syms from /usr/lib/valgrind/memcheck-x86-linux (0x38000000)
--8086--   Considering /usr/lib/valgrind/memcheck-x86-linux ..
--8086--   .. CRC mismatch (computed 2a2bce46 wanted 9ac1affc)
--8086--    object doesn't have a symbol table
--8086--    object doesn't have a dynamic symbol table
--8086-- Reading suppressions file: /usr/lib/valgrind/debian-libc6-dbg.supp
--8086-- Reading suppressions file: /usr/lib/valgrind/default.supp
==8086== embedded gdbserver: reading from /tmp/vgdb-pipe-from-vgdb-to-8086-by-zly-on-???
==8086== embedded gdbserver: writing to   /tmp/vgdb-pipe-to-vgdb-from-8086-by-zly-on-???
==8086== embedded gdbserver: shared mem   /tmp/vgdb-pipe-shared-mem-vgdb-8086-by-zly-on-???
==8086== 
==8086== TO CONTROL THIS PROCESS USING vgdb (which you probably
==8086== don't want to do, unless you know exactly what you're doing,
==8086== or are doing some strange experiment):
==8086==   /usr/lib/valgrind/../../bin/vgdb --pid=8086 ...command...
==8086== 
==8086== TO DEBUG THIS PROCESS USING GDB: start GDB like this
==8086==   /path/to/gdb ./a.out
==8086== and then give GDB the following command
==8086==   target remote | /usr/lib/valgrind/../../bin/vgdb --pid=8086
==8086== --pid is optional if only one valgrind process is running
==8086== 
--8086-- REDIR: 0x40182e0 (strlen) redirected to 0x38056b04 (???)
--8086-- REDIR: 0x4018060 (index) redirected to 0x38056adf (???)
--8086-- Reading syms from /usr/lib/valgrind/vgpreload_core-x86-linux.so (0x4025000)
--8086--   Considering /usr/lib/valgrind/vgpreload_core-x86-linux.so ..
--8086--   .. CRC mismatch (computed 33f4d79f wanted ac058c14)
--8086--    object doesn't have a symbol table
--8086-- Reading syms from /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so (0x4028000)
--8086--   Considering /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so ..
--8086--   .. CRC mismatch (computed 8c6a0645 wanted b38afa17)
--8086--    object doesn't have a symbol table
--8086-- Reading syms from /lib/i386-linux-gnu/libc-2.15.so (0x4049000)
--8086--   Considering /lib/i386-linux-gnu/libc-2.15.so ..
--8086--   .. CRC mismatch (computed a80412a6 wanted a2743b32)
--8086--   Considering /usr/lib/debug/lib/i386-linux-gnu/libc-2.15.so ..
--8086--   .. CRC is valid
--8086-- REDIR: 0x40c6d50 (strnlen) redirected to 0x40254a0 (_vgnU_ifunc_wrapper)
--8086-- REDIR: 0x40c82a0 (strncasecmp) redirected to 0x40254a0 (_vgnU_ifunc_wrapper)
--8086-- REDIR: 0x40c6ef0 (__GI_strrchr) redirected to 0x402c1b0 (__GI_strrchr)
--8086-- REDIR: 0x40c6c90 (__GI_strlen) redirected to 0x402c670 (__GI_strlen)
--8086-- REDIR: 0x40c62e0 (__GI_strchr) redirected to 0x402c2d0 (__GI_strchr)
--8086-- REDIR: 0x40c95c0 (strchrnul) redirected to 0x402ebe0 (strchrnul)
v0.0.2-0
--8086-- REDIR: 0x40c2ec0 (free) redirected to 0x402b000 (free)
--8086-- REDIR: 0x40c29e0 (malloc) redirected to 0x402be00 (malloc)
==8086== Invalid write of size 4
==8086==    at 0x8048522: main (memory_init.c:24)
==8086==  Address 0x41f4030 is 0 bytes after a block of size 8 alloc'd
==8086==    at 0x402BE68: malloc (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==8086==    by 0x8048516: main (memory_init.c:23)
==8086== 
==8086== 
==8086== HEAP SUMMARY:
==8086==     in use at exit: 0 bytes in 0 blocks
==8086==   total heap usage: 1 allocs, 1 frees, 8 bytes allocated
==8086== 
==8086== All heap blocks were freed -- no leaks are possible
==8086== 
==8086== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
==8086== 
==8086== 1 errors in context 1 of 1:
==8086== Invalid write of size 4

/* invald write line number */
==8086==    at 0x8048522: main (memory_init.c:24)
==8086==  Address 0x41f4030 is 0 bytes after a block of size 8 alloc'd
==8086==    at 0x402BE68: malloc (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==8086==    by 0x8048516: main (memory_init.c:23)
==8086== 
==8086== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
我们可以看到写无效的行数。

==============================

"v0.0.2-1"
LEAK memory -- 内存泄漏

diff --git a/memory_init.c b/memory_init.c
index a7150f4..2cef044 100644
--- a/memory_init.c
+++ b/memory_init.c
@@ -1,7 +1,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-#define VERSION	"v0.0.2-0"
+#define VERSION	"v0.0.2-1"
 void printf_version(int argc, char *argv[])
 {
 	int t;
@@ -21,8 +21,6 @@ int main(int argc, char *argv[])
 	printf_version(argc, argv);
 	int *p;
 	p = malloc(sizeof(*p) * 2);
-	p[2]  = 0;
-	free(p);
 
 	return 0;
 }


$ valgrind ./a.out -v
==8390== Memcheck, a memory error detector
==8390== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==8390== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==8390== Command: ./a.out -v
==8390== 
v0.0.2-0
==8390== 

/* leak memory summary */
可以看见在使用当中退出，申请了一次，却没有释放。
==8390== HEAP SUMMARY:
==8390==     in use at exit: 8 bytes in 1 blocks
==8390==   total heap usage: 1 allocs, 0 frees, 8 bytes allocated
==8390== 
==8390== LEAK SUMMARY:
==8390==    definitely lost: 8 bytes in 1 blocks
==8390==    indirectly lost: 0 bytes in 0 blocks
==8390==      possibly lost: 0 bytes in 0 blocks
==8390==    still reachable: 0 bytes in 0 blocks
==8390==         suppressed: 0 bytes in 0 blocks
==8390== Rerun with --leak-check=full to see details of leaked memory
==8390== 
==8390== For counts of detected and suppressed errors, rerun with: -v
==8390== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)

我们使用--leak-check=full选项进一步查看内存泄漏的位置：

$ valgrind --leak-check=full ./a.out -v
==8454== Memcheck, a memory error detector
==8454== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==8454== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==8454== Command: ./a.out -v
==8454== 
v0.0.2-0
==8454== 
==8454== HEAP SUMMARY:
==8454==     in use at exit: 8 bytes in 1 blocks
==8454==   total heap usage: 1 allocs, 0 frees, 8 bytes allocated
==8454== 
==8454== 8 bytes in 1 blocks are definitely lost in loss record 1 of 1
==8454==    at 0x402BE68: malloc (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)

/* leaked memory position */

==8454==    by 0x80484E6: main (memory_init.c:23)
==8454== 
==8454== LEAK SUMMARY:
==8454==    definitely lost: 8 bytes in 1 blocks
==8454==    indirectly lost: 0 bytes in 0 blocks
==8454==      possibly lost: 0 bytes in 0 blocks
==8454==    still reachable: 0 bytes in 0 blocks
==8454==         suppressed: 0 bytes in 0 blocks
==8454== 
==8454== For counts of detected and suppressed errors, rerun with: -v
==8454== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
==============================

"v0.0.2-2"
repaeted free == 重复释放

diff --git a/memory_init.c b/memory_init.c
index 2cef044..db0c2b0 100644
--- a/memory_init.c
+++ b/memory_init.c
@@ -1,7 +1,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-#define VERSION	"v0.0.2-1"
+#define VERSION	"v0.0.2-2"
 void printf_version(int argc, char *argv[])
 {
 	int t;
@@ -21,6 +21,8 @@ int main(int argc, char *argv[])
 	printf_version(argc, argv);
 	int *p;
 	p = malloc(sizeof(*p) * 2);
+	free(p);
+	free(p);
 
 	return 0;
 }

$ valgrind ./a.out -v
==8803== Memcheck, a memory error detector
==8803== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==8803== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==8803== Command: ./a.out -v
==8803== 
v0.0.2-1
		/* repeated free for heap */
==8803== Invalid free() / delete / delete[] / realloc()
==8803==    at 0x402B06C: free (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==8803==    by 0x8048532: main (memory_init.c:25)
==8803==  Address 0x41f4028 is 0 bytes inside a block of size 8 free'd
==8803==    at 0x402B06C: free (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==8803==    by 0x8048526: main (memory_init.c:24)
==8803== 
==8803== 
==8803== HEAP SUMMARY:
==8803==     in use at exit: 0 bytes in 0 blocks
		/* alloc one, buf free two */
==8803==   total heap usage: 1 allocs, 2 frees, 8 bytes allocated
==8803== 
==8803== All heap blocks were freed -- no leaks are possible
==8803== 
==8803== For counts of detected and suppressed errors, rerun with: -v
==8803== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)


我们使用-v选项进一步查看详情：

$ valgrind -v ./a.out -v
==8845== Memcheck, a memory error detector
==8845== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==8845== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==8845== Command: ./a.out -v
==8845== 
--8845-- Valgrind options:
--8845--    --suppressions=/usr/lib/valgrind/debian-libc6-dbg.supp
--8845--    -v
--8845-- Contents of /proc/version:
--8845--   Linux version 3.2.0-55-generic (buildd@allspice) (gcc version 4.6.3
		(Ubuntu/Linaro 4.6.3-1ubuntu5) ) #85-Ubuntu SMP Wed Oct 2
13:43:27 UTC 2013
--8845-- Arch and hwcaps: X86, x86-sse1-sse2
--8845-- Page sizes: currently 4096, max supported 4096
--8845-- Valgrind library directory: /usr/lib/valgrind
--8845-- Reading syms from /lib/i386-linux-gnu/ld-2.15.so (0x4000000)
--8845--   Considering /lib/i386-linux-gnu/ld-2.15.so ..
--8845--   .. CRC mismatch (computed a9bcb2b6 wanted 8af3f2f5)
--8845--   Considering /usr/lib/debug/lib/i386-linux-gnu/ld-2.15.so ..
--8845--   .. CRC is valid
--8845-- Reading syms from /mnt/data/gitstorage/valgrind/a.out (0x8048000)
--8845-- Reading syms from /usr/lib/valgrind/memcheck-x86-linux (0x38000000)
--8845--   Considering /usr/lib/valgrind/memcheck-x86-linux ..
--8845--   .. CRC mismatch (computed 2a2bce46 wanted 9ac1affc)
--8845--    object doesn't have a symbol table
--8845--    object doesn't have a dynamic symbol table
--8845-- Reading suppressions file: /usr/lib/valgrind/debian-libc6-dbg.supp
--8845-- Reading suppressions file: /usr/lib/valgrind/default.supp
==8845== embedded gdbserver: reading from
/tmp/vgdb-pipe-from-vgdb-to-8845-by-zly-on-???
==8845== embedded gdbserver: writing to
/tmp/vgdb-pipe-to-vgdb-from-8845-by-zly-on-???
==8845== embedded gdbserver: shared mem
/tmp/vgdb-pipe-shared-mem-vgdb-8845-by-zly-on-???
==8845== 
==8845== TO CONTROL THIS PROCESS USING vgdb (which you probably
		==8845== don't want to do, unless you know exactly what you're
		doing,
		==8845== or are doing some strange experiment):
==8845==   /usr/lib/valgrind/../../bin/vgdb --pid=8845 ...command...
==8845== 
==8845== TO DEBUG THIS PROCESS USING GDB: start GDB like this
==8845==   /path/to/gdb ./a.out
==8845== and then give GDB the following command
==8845==   target remote | /usr/lib/valgrind/../../bin/vgdb --pid=8845
==8845== --pid is optional if only one valgrind process is running
==8845== 
--8845-- REDIR: 0x40182e0 (strlen) redirected to 0x38056b04 (???)
--8845-- REDIR: 0x4018060 (index) redirected to 0x38056adf (???)
--8845-- Reading syms from /usr/lib/valgrind/vgpreload_core-x86-linux.so
(0x4025000)
--8845--   Considering /usr/lib/valgrind/vgpreload_core-x86-linux.so ..
--8845--   .. CRC mismatch (computed 33f4d79f wanted ac058c14)
--8845--    object doesn't have a symbol table
--8845-- Reading syms from /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so
(0x4028000)
--8845--   Considering /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so ..
--8845--   .. CRC mismatch (computed 8c6a0645 wanted b38afa17)
--8845--    object doesn't have a symbol table
--8845-- Reading syms from /lib/i386-linux-gnu/libc-2.15.so (0x4049000)
--8845--   Considering /lib/i386-linux-gnu/libc-2.15.so ..
--8845--   .. CRC mismatch (computed a80412a6 wanted a2743b32)
--8845--   Considering /usr/lib/debug/lib/i386-linux-gnu/libc-2.15.so ..
--8845--   .. CRC is valid
--8845-- REDIR: 0x40c6d50 (strnlen) redirected to 0x40254a0
(_vgnU_ifunc_wrapper)
--8845-- REDIR: 0x40c82a0 (strncasecmp) redirected to 0x40254a0
(_vgnU_ifunc_wrapper)
--8845-- REDIR: 0x40c6ef0 (__GI_strrchr) redirected to 0x402c1b0
(__GI_strrchr)
--8845-- REDIR: 0x40c6c90 (__GI_strlen) redirected to 0x402c670 (__GI_strlen)
--8845-- REDIR: 0x40c62e0 (__GI_strchr) redirected to 0x402c2d0 (__GI_strchr)
--8845-- REDIR: 0x40c95c0 (strchrnul) redirected to 0x402ebe0 (strchrnul)
v0.0.2-1
--8845-- REDIR: 0x40c2ec0 (free) redirected to 0x402b000 (free)
--8845-- REDIR: 0x40c29e0 (malloc) redirected to 0x402be00 (malloc)
==8845== Invalid free() / delete / delete[] / realloc()
==8845==    at 0x402B06C: free (in
		/usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==8845==    by 0x8048532: main (memory_init.c:25)
==8845==  Address 0x41f4028 is 0 bytes inside a block of size 8 free'd
==8845==    at 0x402B06C: free (in
		/usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==8845==    by 0x8048526: main (memory_init.c:24)
==8845== 
==8845== 
==8845== HEAP SUMMARY:
==8845==     in use at exit: 0 bytes in 0 blocks
==8845==   total heap usage: 1 allocs, 2 frees, 8 bytes allocated
==8845== 
==8845== All heap blocks were freed -- no leaks are possible
==8845== 
==8845== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
==8845== 
==8845== 1 errors in context 1 of 1:
		/* error free position */
==8845== Invalid free() / delete / delete[] / realloc()
==8845==    at 0x402B06C: free (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==8845==    by 0x8048532: main (memory_init.c:25)
		/* first free success */
==8845==  Address 0x41f4028 is 0 bytes inside a block of size 8 free'd
==8845==    at 0x402B06C: free (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==8845==    by 0x8048526: main (memory_init.c:24)
==8845== 
==8845== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
上文注释的地方分别是一次正确释放内存和第二次错误的释放操作。

==============================
+#define VERSION	"v0.0.1-2"
uninitialised values and
Conditional jump or move depends on uninitialised value
使用前未初始化的堆栈，进一步讲，使用了未初始化的值作为了判断条件。

diff --git a/memory_init.c b/memory_init.c
index db0c2b0..7f5be8e 100644
--- a/memory_init.c
+++ b/memory_init.c
@@ -1,7 +1,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-#define VERSION	"v0.0.2-2"
+#define VERSION	"v0.0.1-2"

int main(int argc, char *argv[])
{
        printf_version(argc, argv);

        int a[2];
        if (1 == a[0]) {
                fprintf(stdout, "a[0] is 0\n");
        }   

        return 0;
}

输出查看：
$ valgrind ./a.out -v
==2899== Memcheck, a memory error detector
==2899== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==2899== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==2899== Command: ./a.out -v
==2899== 
v0.0.1-2
	/* if (1 == a[0]) , but a[0] uninitialised */
==2899== Conditional jump or move depends on uninitialised value(s)
==2899==    at 0x80484E2: main (memory_init.c:28)
==2899== 
==2899== 
==2899== HEAP SUMMARY:
==2899==     in use at exit: 0 bytes in 0 blocks
==2899==   total heap usage: 0 allocs, 0 frees, 0 bytes allocated
==2899== 
==2899== All heap blocks were freed -- no leaks are possible
==2899== 
==2899== For counts of detected and suppressed errors, rerun with: -v
==2899== Use --track-origins=yes to see where uninitialised values come from
==2899== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

使用--track-origins=yes查看未初始化的值

$ valgrind --track-origins=yes ./a.out -v
==2907== Memcheck, a memory error detector
==2907== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==2907== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==2907== Command: ./a.out -v
==2907== 
v0.0.1-2
	/* depends uninitialised value on 28 line */
==2907== Conditional jump or move depends on uninitialised value(s)
==2907==    at 0x80484E2: main (memory_init.c:28)

	/* here show positon of uninitialised value */

==2907==  Uninitialised value was created by a stack allocation
==2907==    at 0x80484C6: main (memory_init.c:20)
==2907== 
==2907== 
==2907== HEAP SUMMARY:
==2907==     in use at exit: 0 bytes in 0 blocks
==2907==   total heap usage: 0 allocs, 0 frees, 0 bytes allocated
==2907== 
==2907== All heap blocks were freed -- no leaks are possible
==2907== 
==2907== For counts of detected and suppressed errors, rerun with: -v
==2907== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

-v feature detile of errors
$ valgrind -v ./a.out -v
......
==2914== 1 errors in context 1 of 1:
==2914== Conditional jump or move depends on uninitialised value(s)
==2914==    at 0x80484E2: main (memory_init.c:28)
==2914== 
==2914== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
......

==============================
 19 int main(int argc, char *argv[])
 20 {
 21         printf_version(argc, argv);
 22         char a[10] = "1234567890";
 23         char *p = a + 2;
 24 #include <string.h>
 25         strcpy(a, p);
 26 
 27         return 0;
 28 }

$ valgrind ./a.out -v 
==4498== Memcheck, a memory error detector
==4498== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
==4498== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==4498== Command: ./a.out -v
==4498== 
v0.0.1-3
	/* memory overlap, 提示内存重叠：*/
==4498== Source and destination overlap in strcpy(0xbea5c1c2, 0xbea5c1c4)
==4498==    at 0x402C73B: strcpy (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==4498==    by 0x8048574: main (memory_init.c:25)
==4498== 
==4498== 
==4498== HEAP SUMMARY:
==4498==     in use at exit: 0 bytes in 0 blocks
==4498==   total heap usage: 0 allocs, 0 frees, 0 bytes allocated
==4498== 
==4498== All heap blocks were freed -- no leaks are possible
==4498== 
==4498== For counts of detected and suppressed errors, rerun with: -v
==4498== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

以下是再次加-v选项运行时对错误部分的提示：
==4507== 1 errors in context 1 of 1:
==4507== Source and destination overlap in strcpy(0xbec351c2, 0xbec351c4)
==4507==    at 0x402C73B: strcpy (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
==4507==    by 0x8048574: main (memory_init.c:25)
==4507== 
==4507== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
==============================
==============================
